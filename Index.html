<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Screener - Top Coins</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }

        h1 {
            text-align: center;
        }

        #cryptoTable {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }

        #cryptoTable th, #cryptoTable td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }

        #cryptoTable th {
            background-color: #4CAF50;
            color: white;
        }

        #refreshBtn {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        #refreshBtn:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>

    <h1>Crypto Screener - Top Coins</h1>
    <button id="refreshBtn">Refresh Data</button>
    
    <table id="cryptoTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Price (USD)</th>
                <th>Market Cap</th>
                <th>Change (24h)</th>
                <th>Volume (24h)</th>
                <th>Indicators</th>
                <th>Predicted Next Day</th>
                <th>Predicted 3-5 Days</th>
                <th>Predicted 7 Days</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data will be inserted here -->
        </tbody>
    </table>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Add event listener to the Refresh button
            document.getElementById('refreshBtn').addEventListener('click', refreshData);
            refreshData();
        });

        // Function to fetch data from CoinGecko API (no proxy for testing)
        async function fetchCryptoData() {
            const url = 'https://api.coingecko.com/api/v3/coins/markets';
            const params = new URLSearchParams({
                vs_currency: 'usd',
                order: 'market_cap_desc',
                per_page: 25,  // Load top 25 coins
                page: 1,
                sparkline: false
            });

            try {
                const response = await fetch(`${url}?${params.toString()}`);
                const data = await response.json();

                // Log the raw response data for debugging
                console.log("Raw data from API:", data);
                
                return data;
            } catch (error) {
                console.error('Error fetching data:', error);
                return [];
            }
        }

        // Function to apply filters to the coins list (Low Cap, High Volatility)
        function filterCoins(coins) {
            return coins.filter(coin => {
                // Filter for coins with low market cap and high volatility
                return coin.market_cap < 5000000000 && coin.price_change_percentage_24h > 5;
            });
        }

        // Function to render the fetched data into the table
        function renderTable(coins) {
            const tableBody = document.querySelector('#cryptoTable tbody');
            tableBody.innerHTML = ''; // Clear the table before rendering new data

            if (coins.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="9">No data available</td>`; // Adjusted column span
                tableBody.appendChild(row);
                return;
            }

            // Loop through filtered coins and create a row for each
            coins.forEach(coin => {
                const row = document.createElement('tr');
                
                // Insert the data into each table cell
                row.innerHTML = `
                    <td>${coin.name}</td>
                    <td>$${coin.current_price.toFixed(2)}</td>
                    <td>${coin.market_cap.toLocaleString()}</td>
                    <td>${coin.price_change_percentage_24h ? coin.price_change_percentage_24h.toFixed(2) : 'N/A'}%</td>
                    <td>${coin.total_volume.toLocaleString()}</td>
                    <td>RSI: ${coin.rsi || 'N/A'}, MACD: ${coin.macd || 'N/A'}</td>
                    <td>${calculatePredictedPrice(coin, 1)} USD</td>
                    <td>${calculatePredictedPrice(coin, 3)} USD</td>
                    <td>${calculatePredictedPrice(coin, 7)} USD</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Function to calculate predicted price based on current price and growth percentage
        function calculatePredictedPrice(coin, days) {
            const growthPercentage = coin.price_change_percentage_24h / 100; // Daily growth rate
            const multiplier = Math.pow(1 + growthPercentage, days); // Predicted price multiplier based on days
            return (coin.current_price * multiplier).toFixed(2);
        }

        // Function to refresh the data when the button is clicked
        async function refreshData() {
            console.log("Refreshing data...");
            const coins = await fetchCryptoData();
            const filteredCoins = filterCoins(coins); // Apply filters
            renderTable(filteredCoins);
        }
    </script>

</body>
</html>
