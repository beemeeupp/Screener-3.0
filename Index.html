<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Advanced Crypto and NYSE Screener</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0d1117;
      color: #c9d1d9;
      padding: 10px;
    }
    h1 {
      text-align: center;
      color: #58a6ff;
    }
    .countdown {
      text-align: center;
      margin-bottom: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
      background: #161b22;
    }
    th, td {
      border: 1px solid #30363d;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #21262d;
      color: #58a6ff;
    }
    td {
      color: #c9d1d9;
    }
    .buy { color: #3fb950; }
    .sell { color: #f85149; }
    .hold { color: #d29922; }
  </style>
</head>
<body>
  <h1>Advanced Crypto Screener</h1>
  <div class="countdown">Next refresh in: <span id="countdown">30</span>s</div>

  <div id="tables-container"></div>

  <h1>NYSE Screener</h1>
  <div id="nyse-tables-container">
    <h2>Easy 10% Daily Gains</h2>
    <table id="nyse-easy-gains">
      <thead>
        <tr>
          <th>Ticker</th>
          <th>Price</th>
          <th>RSI</th>
          <th>MACD</th>
          <th>Signal</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2>Mini Moons (50%+ Potential)</h2>
    <table id="nyse-mini-moons">
      <thead>
        <tr>
          <th>Ticker</th>
          <th>Price</th>
          <th>RSI</th>
          <th>MACD</th>
          <th>Signal</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2>Moon Shot Stocks (100%+ Potential)</h2>
    <table id="nyse-moon-shots">
      <thead>
        <tr>
          <th>Ticker</th>
          <th>Price</th>
          <th>RSI</th>
          <th>MACD</th>
          <th>Signal</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="refresh-timer" id="nyse-timer">
      Refreshing in <span id="nyse-countdown">15</span> seconds...
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/technicalindicators"></script> <!-- For RSI and MACD calculations -->
  <script>
    // Crypto Screener Script
    const tables = {
      "20%+ Daily Gains": [],
      "15%+ Daily Gains": [],
      "10%+ Daily Gains": [],
      "5%+ Daily Gains": []
    };

    async function fetchCoins() {
      const res = await fetch("https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=percent_change_24h_desc&per_page=100&page=1&sparkline=true&price_change_percentage=24h");
      const data = await res.json();

      Object.keys(tables).forEach(key => tables[key] = []);

      for (let coin of data) {
        const change = coin.price_change_percentage_24h;
        const obj = {
          name: coin.name,
          price: `$${coin.current_price.toFixed(4)}`,
          market_cap: `$${coin.market_cap.toLocaleString()}`,
          change: `${change.toFixed(2)}%`,
          sparkline: coin.sparkline_in_7d.price
        };

        if (change >= 20) tables["20%+ Daily Gains"].push(obj);
        else if (change >= 15) tables["15%+ Daily Gains"].push(obj);
        else if (change >= 10) tables["10%+ Daily Gains"].push(obj);
        else if (change >= 5) tables["5%+ Daily Gains"].push(obj);
      }
    }

    function calculateRSI(prices) {
      if (!prices || prices.length < 15) return "N/A";
      let gains = 0, losses = 0;
      for (let i = 1; i < 15; i++) {
        const diff = prices[i] - prices[i - 1];
        if (diff >= 0) gains += diff;
        else losses -= diff;
      }
      if (losses === 0) return 100;
      const rs = gains / losses;
      const rsi = 100 - (100 / (1 + rs));
      return rsi.toFixed(2);
    }

    function calculateMACD(prices) {
      if (!prices || prices.length < 26) return "N/A";
      const ema = (period, data) => {
        const k = 2 / (period + 1);
        let emaArray = [data[0]];
        for (let i = 1; i < data.length; i++) {
          emaArray.push(data[i] * k + emaArray[i - 1] * (1 - k));
        }
        return emaArray;
      };
      const ema12 = ema(12, prices);
      const ema26 = ema(26, prices);
      const macd = ema12.slice(-1)[0] - ema26.slice(-1)[0];
      return macd.toFixed(4);
    }

    function determineSignal(rsi, macd) {
      if (rsi === "N/A" || macd === "N/A") return "N/A";
      rsi = parseFloat(rsi);
      macd = parseFloat(macd);
      if (rsi < 30 && macd > 0) return "<span class='buy'>Buy</span>";
      else if (rsi > 70 && macd < 0) return "<span class='sell'>Sell</span>";
      else return "<span class='hold'>Hold</span>";
    }

    function renderTables() {
      const container = document.getElementById("tables-container");
      container.innerHTML = "";

      for (let category in tables) {
        const coins = tables[category];
        let html = `<h2>${category}</h2>`;
        html += `
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Price</th>
                <th>Market Cap</th>
                <th>24h Change</th>
                <th>RSI</th>
                <th>MACD</th>
                <th>Signal</th>
                <th>Hold Time</th>
              </tr>
            </thead>
            <tbody>
        `;
        for (let coin of coins) {
          const rsi = calculateRSI(coin.sparkline);
          const macd = calculateMACD(coin.sparkline);
          const signal = determineSignal(rsi, macd);
          html += `
            <tr>
              <td>${coin.name}</td>
              <td>${coin.price}</td>
              <td>${coin.market_cap}</td>
              <td>${coin.change}</td>
              <td>${rsi}</td>
              <td>${macd}</td>
              <td>${signal}</td>
              <td>4h</td>
            </tr>
          `;
        }
        html += `</tbody></table>`;
        container.innerHTML += html;
      }
    }

    async function refresh() {
      await fetchCoins();
      renderTables();
    }

    let countdown = 30;
    setInterval(() => {
      countdown--;
      if (countdown <= 0) {
        countdown = 30;
        refresh();
      }
      document.getElementById("countdown").innerText = countdown;
    }, 1000);

    refresh(); // Initial load

    // NYSE Stock Screener Code
    async function fetchNYSEData() {
      const tickers = ['AAPL', 'GOOGL', 'AMZN', 'MSFT', 'TSLA']; // Example tickers

      for (const ticker of tickers) {
        const res = await fetch(`https://api.twelvedata.com/time_series?symbol=${ticker}&interval=1day&apikey=YOUR_TWELVE_DATA_API_KEY`);
        const data = await res.json();

        if (data.values) {
          const latestData = data.values[0];
          const closePrice = parseFloat(latestData.close);
          const rsi = calculateRSI(data.values.map(item => parseFloat(item.close)));
          const macd = calculateMACD(data.values.map(item => parseFloat(item.close)));
          const signal = determineSignal(rsi, macd);

          // Insert into table based on certain criteria (e.g., change, RSI, etc.)
          let tableId = "nyse-easy-gains";  // Example for 10% daily gains
          if (closePrice >= 100) tableId = "nyse-mini-moons";
          else if (closePrice >= 200) tableId = "nyse-moon-shots";

          document.querySelector(`#${tableId} tbody`).innerHTML += `
            <tr>
              <td>${ticker}</td>
              <td>${closePrice.toFixed(2)}</td>
              <td>${rsi}</td>
              <td>${macd}</td>
              <td>${signal}</td>
            </tr>
          `;
        }
      }
    }

    async function startNYSERefresh() {
      await fetchNYSEData();
      setInterval(() => {
        fetchNYSEData();
        document.getElementById("nyse-countdown").innerText = 15;
      }, 15000);
    }

    startNYSERefresh(); // Initialize NYSE refresh
  </script>
</body>
</html>
