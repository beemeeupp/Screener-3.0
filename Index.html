<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Advanced Crypto Screener</title>
  <script src="https://cdn.jsdelivr.net/npm/technicalindicators@3.0.0/dist/browser/technicalindicators.min.js"></script>
  <style>
    body {
      background-color: #0e0e10;
      font-family: 'Segoe UI', sans-serif;
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    h1, h2 {
      text-align: center;
      margin-bottom: 10px;
    }
    .refresh-timer {
      text-align: center;
      font-size: 18px;
      margin-bottom: 30px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 30px auto;
      background-color: #1a1a1d;
    }
    th, td {
      padding: 10px;
      text-align: center;
      border: 1px solid #333;
    }
    th {
      background-color: #222;
      color: #00fff2;
    }
    td {
      color: #e0e0e0;
    }
    .buy { color: #0f0; font-weight: bold; }
    .sell { color: #f00; font-weight: bold; }
    .hold { color: #ff0; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Advanced Crypto Screener</h1>
  <div class="refresh-timer">Next refresh in: <span id="countdown">30</span>s</div>

  <h2>20%+ Daily Gains</h2>
  <table id="table-20">
    <thead>
      <tr>
        <th>Name</th><th>Price</th><th>Market Cap</th><th>24h Change</th>
        <th>RSI</th><th>MACD</th><th>Signal</th><th>Hold Time</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>15%+ Daily Gains</h2>
  <table id="table-15">
    <thead>
      <tr>
        <th>Name</th><th>Price</th><th>Market Cap</th><th>24h Change</th>
        <th>RSI</th><th>MACD</th><th>Signal</th><th>Hold Time</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>10%+ Daily Gains</h2>
  <table id="table-10">
    <thead>
      <tr>
        <th>Name</th><th>Price</th><th>Market Cap</th><th>24h Change</th>
        <th>RSI</th><th>MACD</th><th>Signal</th><th>Hold Time</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>5%+ Daily Gains</h2>
  <table id="table-5">
    <thead>
      <tr>
        <th>Name</th><th>Price</th><th>Market Cap</th><th>24h Change</th>
        <th>RSI</th><th>MACD</th><th>Signal</th><th>Hold Time</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const coins = [
      'bitcoin', 'ethereum', 'solana', 'binancecoin', 'kaspa', 'pepe', 'render-token', 
      'dogecoin', 'shiba-inu', 'aptos', 'arbitrum', 'the-graph', 'blur', 'bonk'
    ];

    async function fetchPrices(id) {
      const res = await fetch(`https://api.coingecko.com/api/v3/coins/${id}/market_chart?vs_currency=usd&days=30`);
      const data = await res.json();
      return data.prices.map(p => p[1]);
    }

    function calculateIndicators(prices) {
      const rsi = technicalindicators.RSI.calculate({ period: 14, values: prices });
      const macd = technicalindicators.MACD.calculate({
        values: prices,
        fastPeriod: 12,
        slowPeriod: 26,
        signalPeriod: 9,
        SimpleMAOscillator: false,
        SimpleMASignal: false
      });
      return {
        rsi: rsi.at(-1)?.toFixed(2) || 'N/A',
        macdValue: macd.at(-1)?.MACD?.toFixed(2) || 'N/A',
        signalValue: macd.at(-1)?.signal?.toFixed(2) || 'N/A'
      };
    }

    function getSignal(rsi, macd, signal) {
      if (rsi < 30 && macd > signal) return 'Buy';
      if (rsi > 70 && macd < signal) return 'Sell';
      return 'Hold';
    }

    async function updateData() {
      const marketRes = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${coins.join(',')}&order=percent_change_24h_desc`);
      const marketData = await marketRes.json();

      const categories = {
        "20": [],
        "15": [],
        "10": [],
        "5": []
      };

      for (const coin of marketData) {
        if (coin.price_change_percentage_24h < 5) continue;

        const prices = await fetchPrices(coin.id);
        const indicators = calculateIndicators(prices);
        const signal = getSignal(Number(indicators.rsi), Number(indicators.macdValue), Number(indicators.signalValue));

        const row = `
          <tr>
            <td>${coin.name} (${coin.symbol.toUpperCase()})</td>
            <td>$${coin.current_price.toFixed(4)}</td>
            <td>$${Number(coin.market_cap).toLocaleString()}</td>
            <td>${coin.price_change_percentage_24h.toFixed(2)}%</td>
            <td>${indicators.rsi}</td>
            <td>${indicators.macdValue}</td>
            <td class="${signal.toLowerCase()}">${signal}</td>
            <td>4h</td>
          </tr>
        `;

        if (coin.price_change_percentage_24h >= 20) categories["20"].push(row);
        else if (coin.price_change_percentage_24h >= 15) categories["15"].push(row);
        else if (coin.price_change_percentage_24h >= 10) categories["10"].push(row);
        else if (coin.price_change_percentage_24h >= 5) categories["5"].push(row);
      }

      document.querySelector('#table-20 tbody').innerHTML = categories["20"].join('');
      document.querySelector('#table-15 tbody').innerHTML = categories["15"].join('');
      document.querySelector('#table-10 tbody').innerHTML = categories["10"].join('');
      document.querySelector('#table-5 tbody').innerHTML = categories["5"].join('');
    }

    let countdown = 30;
    setInterval(() => {
      countdown--;
      document.getElementById('countdown').textContent = countdown;
      if (countdown === 0) {
        countdown = 30;
        updateData();
      }
    }, 1000);

    updateData();
  </script>
</body>
</html>
