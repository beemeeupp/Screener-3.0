<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Advanced Crypto and NYSE Screener</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0d1117;
      color: #c9d1d9;
      padding: 10px;
    }
    h1 {
      text-align: center;
      color: #58a6ff;
    }
    .countdown {
      text-align: center;
      margin-bottom: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
      background: #161b22;
    }
    th, td {
      border: 1px solid #30363d;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #21262d;
      color: #58a6ff;
    }
    td {
      color: #c9d1d9;
    }
    .buy { color: #3fb950; }
    .sell { color: #f85149; }
    .hold { color: #d29922; }
  </style>
</head>
<body>
  <h1>Advanced Crypto Screener</h1>
  <div class="countdown">Next refresh in: <span id="countdown">30</span>s</div>

  <div id="tables-container"></div>

  <h1>NYSE Screener</h1>
  <div id="nyse-tables-container">
    <h2>5% Daily Gains</h2>
    <table id="nyse-5-gains">
      <thead>
        <tr>
          <th>Ticker</th>
          <th>Price</th>
          <th>Change</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2>10% Daily Gains</h2>
    <table id="nyse-10-gains">
      <thead>
        <tr>
          <th>Ticker</th>
          <th>Price</th>
          <th>Change</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2>15% Daily Gains</h2>
    <table id="nyse-15-gains">
      <thead>
        <tr>
          <th>Ticker</th>
          <th>Price</th>
          <th>Change</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="refresh-timer" id="nyse-timer">
      Refreshing in <span id="nyse-countdown">15</span> seconds...
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/technicalindicators"></script> <!-- For RSI and MACD calculations -->
  <script>
    const apiKey = 'GGYIWPPUWG7Y3GW4'; // Alpha Vantage API key
    const stockSymbols = ["AAPL", "MSFT", "GOOGL", "AMZN", "TSLA", "FB"]; // Example NYSE stocks to track
    
    // Function to fetch data from Alpha Vantage API
    async function fetchStockData(symbol) {
      const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=${apiKey}`;
      const response = await fetch(url);
      const data = await response.json();

      if (data["Time Series (Daily)"]) {
        const timeSeries = data["Time Series (Daily)"];
        const dates = Object.keys(timeSeries);
        const latestData = timeSeries[dates[0]]; // Get the most recent day's data
        const previousData = timeSeries[dates[1]]; // Get the second most recent day's data

        const latestClose = parseFloat(latestData["4. close"]);
        const previousClose = parseFloat(previousData["4. close"]);
        const dailyChange = ((latestClose - previousClose) / previousClose) * 100; // Calculate percent change

        return {
          symbol: symbol,
          price: latestClose.toFixed(2),
          change: dailyChange.toFixed(2),
        };
      }
      return null;
    }

    async function fetchNYSEStocks() {
      const stocksData = [];
      for (const symbol of stockSymbols) {
        const stockData = await fetchStockData(symbol);
        if (stockData) {
          stocksData.push(stockData);
        }
      }
      return stocksData;
    }

    function renderNYSEData(data) {
      const nyseTables = {
        "5% Daily Gains": [],
        "10% Daily Gains": [],
        "15% Daily Gains": []
      };

      // Classify data into gain categories
      for (let stock of data) {
        const change = parseFloat(stock.change);
        const stockInfo = {
          ticker: stock.symbol,
          price: `$${stock.price}`,
          change: `${stock.change}%`
        };

        if (change >= 15) nyseTables["15% Daily Gains"].push(stockInfo);
        else if (change >= 10) nyseTables["10% Daily Gains"].push(stockInfo);
        else if (change >= 5) nyseTables["5% Daily Gains"].push(stockInfo);
      }

      // Render tables on the page
      for (let category in nyseTables) {
        const tableData = nyseTables[category];
        const table = document.getElementById(`nyse-${category.toLowerCase().replace(" ", "-")}`);
        const tbody = table.querySelector('tbody');
        tbody.innerHTML = '';

        tableData.forEach(stock => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${stock.ticker}</td>
            <td>${stock.price}</td>
            <td class="${stock.change > 0 ? 'buy' : stock.change < 0 ? 'sell' : 'hold'}">${stock.change}</td>
          `;
          tbody.appendChild(row);
        });
      }
    }

    async function refreshNYSE() {
      const nyseData = await fetchNYSEStocks();
      renderNYSEData(nyseData);
    }

    let nyseCountdown = 15;
    setInterval(() => {
      nyseCountdown--;
      if (nyseCountdown <= 0) {
        nyseCountdown = 15;
        refreshNYSE();
      }
      document.getElementById("nyse-countdown").innerText = nyseCountdown;
    }, 1000);

    // Crypto Screener Script
    const tables = {
      "20%+ Daily Gains": [],
      "15%+ Daily Gains": [],
      "10%+ Daily Gains": [],
      "5%+ Daily Gains": []
    };

    async function fetchCoins() {
      const res = await fetch("https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=percent_change_24h_desc&per_page=100&page=1&sparkline=true&price_change_percentage=24h");
      const data = await res.json();

      Object.keys(tables).forEach(key => tables[key] = []);

      for (let coin of data) {
        const change = coin.price_change_percentage_24h;
        const obj = {
          name: coin.name,
          price: `$${coin.current_price.toFixed(4)}`,
          market_cap: `$${coin.market_cap.toLocaleString()}`,
          change: `${change.toFixed(2)}%`,
          sparkline: coin.sparkline_in_7d.price
        };

        if (change >= 20) tables["20%+ Daily Gains"].push(obj);
        else if (change >= 15) tables["15%+ Daily Gains"].push(obj);
        else if (change >= 10) tables["10%+ Daily Gains"].push(obj);
        else if (change >= 5) tables["5%+ Daily Gains"].push(obj);
      }
    }

    function renderTables() {
      const container = document.getElementById("tables-container");
      container.innerHTML = "";

      for (let category in tables) {
        const coins = tables[category];
        let html = `<h2>${category}</h2>`;
        html += `
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Price</th>
                <th>Market Cap</th>
                <th>24h Change</th>
                <th>RSI</th>
                <th>MACD</th>
                <th>Signal</th>
                <th>Hold Time</th>
              </tr>
            </thead>
            <tbody>
        `;
        for (let coin of coins) {
          const rsi = "N/A";  // RSI and MACD are not calculated in this part
          const macd = "N/A";
          const signal = "N/A"; // Placeholder for now
          html += `
            <tr>
              <td>${coin.name}</td>
              <td>${coin.price}</td>
              <td>${coin.market_cap}</td>
              <td>${coin.change}</td>
              <td>${rsi}</td>
              <td>${macd}</td>
              <td>${signal}</td>
              <td>4h</td>
            </tr>
          `;
        }
        html += `</tbody></table>`;
        container.innerHTML += html;
      }
    }

    async function refresh() {
      await fetchCoins();
      renderTables();
    }

    let countdown = 30;
    setInterval(() => {
      countdown--;
      if (countdown <= 0) {
        countdown = 30;
        refresh();
      }
      document.getElementById("countdown").innerText = countdown;
    }, 1000);

    refresh(); // Initial load
  </script>
</body>
</html>
