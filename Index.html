<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Real-Time Advanced Crypto Screener</title>
  <script src="https://cdn.jsdelivr.net/npm/technicalindicators@3.0.0/dist/browser/technicalindicators.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #0d1117;
      color: #c9d1d9;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #58a6ff;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 25px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #30363d;
      text-align: center;
    }
    th {
      background-color: #161b22;
    }
    .buy {
      color: #00ff00;
    }
    .sell {
      color: #ff4d4d;
    }
    .hold {
      color: #ffd700;
    }
    #refresh-timer {
      text-align: center;
      font-size: 14px;
      margin-top: 10px;
      color: #8b949e;
    }
  </style>
</head>
<body>
  <h1>Real-Time Advanced Crypto Screener</h1>
  <div id="refresh-timer">Refreshing in: <span id="countdown">30</span>s</div>
  <table id="screener">
    <thead>
      <tr>
        <th>Name</th>
        <th>Price</th>
        <th>Market Cap</th>
        <th>24h %</th>
        <th>RSI</th>
        <th>MACD</th>
        <th>Signal</th>
        <th>Hold Time</th>
      </tr>
    </thead>
    <tbody id="screener-body">
      <!-- Data will be populated here -->
    </tbody>
  </table>

  <script>
    const coins = [
      { id: 'bitcoin', symbol: 'BTC', name: 'Bitcoin' },
      { id: 'ethereum', symbol: 'ETH', name: 'Ethereum' },
      { id: 'solana', symbol: 'SOL', name: 'Solana' },
      { id: 'binancecoin', symbol: 'BNB', name: 'BNB' },
      { id: 'render-token', symbol: 'RNDR', name: 'Render' },
      { id: 'kaspa', symbol: 'KAS', name: 'Kaspa' },
      { id: 'pepe', symbol: 'PEPE', name: 'Pepe' }
    ];

    async function fetchCoinData(coin) {
      const url = `https://api.coingecko.com/api/v3/coins/${coin.id}/market_chart?vs_currency=usd&days=30&interval=daily`;
      const res = await fetch(url);
      const data = await res.json();
      const prices = data.prices.map(p => p[1]);
      return prices;
    }

    function calculateIndicators(prices) {
      const rsi = technicalindicators.RSI.calculate({ period: 14, values: prices }) || [0];
      const macd = technicalindicators.MACD.calculate({
        values: prices,
        fastPeriod: 12,
        slowPeriod: 26,
        signalPeriod: 9,
        SimpleMAOscillator: false,
        SimpleMASignal: false
      }) || [{ MACD: 0, signal: 0 }];

      return {
        rsi: rsi[rsi.length - 1] || 0,
        macd: macd[macd.length - 1] || { MACD: 0, signal: 0 }
      };
    }

    function generateSignal(rsi, macd) {
      if (rsi < 30 && macd.MACD > macd.signal) return 'Buy';
      if (rsi > 70 && macd.MACD < macd.signal) return 'Sell';
      return 'Hold';
    }

    async function updateTable() {
      const tbody = document.getElementById('screener-body');
      tbody.innerHTML = '';
      const marketData = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${coins.map(c => c.id).join(',')}&order=market_cap_desc&sparkline=false`).then(r => r.json());

      for (const coin of coins) {
        const market = marketData.find(c => c.id === coin.id);
        const prices = await fetchCoinData(coin);
        const { rsi, macd } = calculateIndicators(prices);
        const signal = generateSignal(rsi, macd);

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${coin.name} (${coin.symbol.toUpperCase()})</td>
          <td>$${market.current_price.toFixed(2)}</td>
          <td>$${Number(market.market_cap).toLocaleString()}</td>
          <td>${market.price_change_percentage_24h.toFixed(2)}%</td>
          <td>${rsi.toFixed(2)}</td>
          <td>${macd.MACD.toFixed(2)}</td>
          <td class="${signal.toLowerCase()}">${signal}</td>
          <td>4h</td>
        `;
        tbody.appendChild(row);
      }
    }

    let countdown = 30;
    setInterval(() => {
      countdown--;
      if (countdown <= 0) {
        countdown = 30;
        updateTable();
      }
      document.getElementById('countdown').textContent = countdown;
    }, 1000);

    updateTable();
  </script>
</body>
</html>
