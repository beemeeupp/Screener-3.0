<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Crypto Screener</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .table-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        table {
            width: 23%;
            border-collapse: collapse;
            margin: 10px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        th, td {
            padding: 8px;
            text-align: center;
            border: 1px solid #ddd;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        .refresh-time {
            text-align: center;
            font-size: 18px;
            margin-top: 20px;
        }
        .loading {
            color: #999;
        }
    </style>
</head>
<body>

    <h1>Advanced Crypto Screener</h1>
    <div class="table-container">
        <div>
            <h3>20%+ Daily Gains</h3>
            <table id="20plus">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Market Cap</th>
                        <th>24h Change</th>
                        <th>RSI</th>
                        <th>MACD</th>
                        <th>Signal</th>
                        <th>Hold Time</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data rows will be inserted here -->
                </tbody>
            </table>
        </div>
        <div>
            <h3>15%+ Daily Gains</h3>
            <table id="15plus">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Market Cap</th>
                        <th>24h Change</th>
                        <th>RSI</th>
                        <th>MACD</th>
                        <th>Signal</th>
                        <th>Hold Time</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data rows will be inserted here -->
                </tbody>
            </table>
        </div>
        <div>
            <h3>10%+ Daily Gains</h3>
            <table id="10plus">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Market Cap</th>
                        <th>24h Change</th>
                        <th>RSI</th>
                        <th>MACD</th>
                        <th>Signal</th>
                        <th>Hold Time</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data rows will be inserted here -->
                </tbody>
            </table>
        </div>
        <div>
            <h3>5%+ Daily Gains</h3>
            <table id="5plus">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Market Cap</th>
                        <th>24h Change</th>
                        <th>RSI</th>
                        <th>MACD</th>
                        <th>Signal</th>
                        <th>Hold Time</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data rows will be inserted here -->
                </tbody>
            </table>
        </div>
    </div>

    <div class="refresh-time">
        <p>Next refresh in: <span id="timer">30</span>s</p>
    </div>

    <script>
        const apiUrl = 'https://api.coingecko.com/api/v3/coins/markets';
        let refreshInterval;

        // List of cryptocurrency tickers for fetching data
        const cryptoList = ['bitcoin', 'ethereum', 'solana', 'cardano', 'ripple'];

        // Function to calculate RSI
        function calculateRSI(prices, period = 14) {
            const gains = [];
            const losses = [];

            for (let i = 1; i < prices.length; i++) {
                const change = prices[i] - prices[i - 1];
                if (change > 0) gains.push(change);
                else losses.push(Math.abs(change));
            }

            const avgGain = gains.slice(0, period).reduce((a, b) => a + b, 0) / period;
            const avgLoss = losses.slice(0, period).reduce((a, b) => a + b, 0) / period;

            const rs = avgGain / avgLoss;
            const rsi = 100 - (100 / (1 + rs));

            return rsi.toFixed(2);
        }

        // Function to calculate MACD
        function calculateMACD(prices, shortTerm = 12, longTerm = 26, signalTerm = 9) {
            const shortEMA = calculateEMA(prices, shortTerm);
            const longEMA = calculateEMA(prices, longTerm);

            const macd = shortEMA.map((v, i) => v - longEMA[i]);
            const signalLine = calculateEMA(macd, signalTerm);

            return { macd: macd[macd.length - 1], signal: signalLine[signalLine.length - 1] };
        }

        // Function to calculate EMA (Exponential Moving Average)
        function calculateEMA(prices, period) {
            const k = 2 / (period + 1);
            const ema = [prices[0]];

            for (let i = 1; i < prices.length; i++) {
                ema.push(prices[i] * k + ema[i - 1] * (1 - k));
            }

            return ema;
        }

        // Fetching crypto data and populating the tables
        async function fetchData() {
            try {
                const response = await fetch(`${apiUrl}?vs_currency=usd&ids=${cryptoList.join(',')}`);
                const data = await response.json();

                data.forEach((crypto, index) => {
                    const { id, current_price, market_cap, price_change_percentage_24h } = crypto;

                    // Placeholder for prices over the last 30 days (to calculate RSI and MACD)
                    const historicalPrices = [/* Add price data here for the past 30 days */];

                    const rsi = calculateRSI(historicalPrices);
                    const { macd, signal } = calculateMACD(historicalPrices);

                    // Find the table to insert data based on the 24h change
                    const table = document.querySelector(`#${getTableId(price_change_percentage_24h)}`);
                    const row = table.querySelector('tbody').insertRow();

                    row.innerHTML = `
                        <td>${crypto.name}</td>
                        <td>$${current_price}</td>
                        <td>$${market_cap.toLocaleString()}</td>
                        <td>${price_change_percentage_24h.toFixed(2)}%</td>
                        <td>${rsi}</td>
                        <td>${macd.toFixed(2)}</td>
                        <td>${signal.toFixed(2)}</td>
                        <td>${getHoldTime(price_change_percentage_24h)}</td>
                    `;
                });

                // Update the refresh timer
                startTimer();
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // Helper function to determine table based on percentage change
        function getTableId(change) {
            if (change >= 20) return '20plus';
            if (change >= 15) return '15plus';
            if (change >= 10) return '10plus';
            return '5plus';
        }

        // Helper function to determine hold time based on percentage change
        function getHoldTime(change) {
            if (change >= 20) return '2h';
            if (change >= 15) return '3h';
            if (change >= 10) return '4h';
            return '5h';
        }

        // Timer for auto-refresh
        function startTimer() {
            let timer = 30;
            document.getElementById('timer').textContent = timer;

            refreshInterval = setInterval(() => {
                timer--;
                document.getElementById('timer').textContent = timer;

                if (timer <= 0) {
                    fetchData();
                    timer = 30;
                }
            }, 1000);
        }

        // Initialize the screener
        fetchData();
    </script>
</body>
</html>
